import recpack.algorithms
import scipy.sparse
import math
import numpy


def test_ease():
    values = [1] * 9
    users = [0, 0, 1, 1, 2, 2, 2, 3, 3]
    items = [0, 2, 0, 2, 0, 1, 2, 0, 2]
    data = scipy.sparse.csr_matrix((values, (users, items)), shape=(5, 3))

    algo = recpack.algorithms.algorithm_registry.get("ease")(l2=0.03)

    algo.fit(data)

    # Make sure the predictions "make sense"
    _in = scipy.sparse.csr_matrix(([1, 1, 1], ([0, 1, 2], [0, 1, 2])), shape=(3, 3))
    result = algo.predict(_in)

    numpy.testing.assert_almost_equal(result[2, 0], 1, decimal=1)
    numpy.testing.assert_almost_equal(result[0, 2], 1, decimal=1)
